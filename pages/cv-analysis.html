<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de CV com IA | Share2Inspire</title>
    <meta name="description" content="Analise o seu Curriculum Vitae com intelig√™ncia artificial.">

    <link rel="icon" href="../images/favicon.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <!-- Consolidated Styles: Design System + Header/Footer -->
    <link rel="stylesheet" href="../css/consolidated-styles.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <img src="../images/logo.png" alt="Share2Inspire" height="50">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="../index.html">In√≠cio</a></li>
                    <li class="nav-item"><a class="nav-link" href="sobre.html">Sobre</a></li>
                    <li class="nav-item"><a class="nav-link" href="servicos.html">Servi√ßos</a></li>
                    <li class="nav-item"><a class="nav-link active" href="cv-analysis.html">CV Analyser</a></li>
                    <li class="nav-item"><a class="nav-link" href="loja.html">Loja</a></li>
                    <li class="nav-item"><a class="nav-link" href="people-hub.html">People Hub</a></li>
                </ul>
            </div>
        </div>
    </nav>


    <section class="page-hero py-5" style="background: #f8f9fa; padding-top: 120px !important;">
        <div class="container">
            <h1 style="font-size: 2.8rem; font-weight: 700; color: #2d2d2d; margin-bottom: 0.75rem;">
                CV Analyser
            </h1>
            <nav aria-label="breadcrumb">
                <p style="font-size: 0.9rem; font-weight: 400; color: #6c757d; margin: 0;">
                    <a href="../index.html" style="color: #BF9A33; text-decoration: none;">In√≠cio</a>
                    <span style="margin: 0 0.5rem;">/</span>
                    <span>CV Analyser</span>
                </p>
            </nav>
        </div>
    </section>

    <section class="upload-section py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <div class="maturity-score-card p-5">
                        <div class="icon-wrapper mb-4">
                            <i class="fas fa-cloud-upload-alt fa-4x" style="color: #BF9A33;"></i>
                        </div>
                        <h3 class="fw-bold">Carrega o teu CV</h3>
                        <p class="text-muted mb-4">O processamento √© feito localmente e em tempo real.</p>

                        <div class="file-upload-wrapper">
                            <input type="file" id="cvFile" accept=".pdf,.docx" class="file-input" hidden>
                            <label for="cvFile" class="s2i-btn s2i-btn-outline">
                                <i class="fas fa-file-pdf me-2"></i>Selecionar CV
                            </label>
                            <span id="fileName" class="d-block mt-3 text-muted fst-italic"></span>
                        </div>

                        <button id="analyzeBtn" class="s2i-btn s2i-btn-primary mt-4 px-5" disabled>
                            <span id="btnText">SUBMETER</span>
                            <span id="btnSpinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- MODAL DE RESULTADOS - Design Clean e Minimalista -->
    <div class="modal fade" id="resultsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable modal-dialog-centered" style="max-width: 900px;">
            <div class="modal-content" style="border: none; border-radius: 16px; overflow: hidden;">
                
                <!-- HEADER MINIMALISTA -->
                <div class="modal-header" style="background: #fff; border-bottom: 1px solid #eee; padding: 1.5rem 2rem;">
                    <div>
                        <h5 class="modal-title" style="font-weight: 600; font-size: 1.25rem; color: #1a1a1a; margin: 0;">An√°lise do Perfil</h5>
                        <p style="font-size: 0.8rem; color: #888; margin: 0.25rem 0 0 0;">Leitura autom√°tica baseada em estrutura e conte√∫do</p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" style="opacity: 0.5;"></button>
                </div>
                
                <!-- BODY CLEAN -->
                <div class="modal-body" style="background: #fff; padding: 2rem;">

                    <!-- SCORE PRINCIPAL -->
                    <div style="text-align: center; margin-bottom: 2.5rem;">
                        <div style="font-size: 4rem; font-weight: 700; color: #1a1a1a; line-height: 1;" id="maturityScore">--</div>
                        <div style="font-size: 0.85rem; color: #999; margin-top: 0.25rem;">Maturidade Profissional</div>
                        <div style="width: 200px; height: 4px; background: #f0f0f0; border-radius: 2px; margin: 1rem auto 0.5rem;">
                            <div id="maturityProgressBar" style="height: 100%; background: #1a1a1a; border-radius: 2px; width: 0%; transition: width 1s ease;"></div>
                        </div>
                        <span id="maturityLabel" style="font-size: 0.75rem; color: #666; text-transform: uppercase; letter-spacing: 1px;">Em an√°lise</span>
                    </div>

                    <!-- PERFIL PROFISSIONAL -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Perfil Profissional</h6>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem;">
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Experi√™ncia</div>
                                <div id="yearsExp" style="font-size: 0.95rem; color: #1a1a1a; font-weight: 500;">A calcular...</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">√Årea Principal</div>
                                <div id="mainArea" style="font-size: 0.95rem; color: #1a1a1a; font-weight: 500;">A identificar...</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Senioridade</div>
                                <div id="seniorityLevel" style="font-size: 0.95rem; color: #1a1a1a; font-weight: 500;">A avaliar...</div>
                            </div>
                        </div>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- RESUMO AI -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Resumo AI</h6>
                        <div id="geminiGlobalSummary" style="font-size: 0.9rem; color: #444; line-height: 1.7;">
                            <p style="margin: 0;">A gerar an√°lise...</p>
                        </div>
                    </div>

                    <!-- PONTOS FORTES -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Pontos Fortes</h6>
                        <ul id="aiStrengths" style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: #444;">
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid #f5f5f5;">A analisar...</li>
                        </ul>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- COMPET√äNCIAS -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Compet√™ncias</h6>
                        
                        <div style="margin-bottom: 1.25rem;">
                            <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.5rem;">Hard Skills</div>
                            <div id="hardSkillsList" style="font-size: 0.9rem; color: #1a1a1a;">A identificar...</div>
                        </div>
                        
                        <div style="margin-bottom: 1.25rem;">
                            <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.5rem;">Soft Skills</div>
                            <div id="softSkillsList" style="font-size: 0.9rem; color: #1a1a1a;">A identificar...</div>
                        </div>
                        
                        <div>
                            <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.5rem;">Idiomas</div>
                            <div id="languagesList" style="font-size: 0.9rem; color: #1a1a1a;">A identificar...</div>
                        </div>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- AN√ÅLISE POR DIMENS√ÉO - Stacked Bars -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1.5rem;">An√°lise por Dimens√£o</h6>
                        
                        <div style="display: grid; gap: 1rem;">
                            <!-- Estrutura -->
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 0.85rem; font-weight: 500; color: #1a1a1a; width: 90px;">Estrutura</span>
                                <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; position: relative;">
                                    <div id="barEstrutura" style="height: 100%; background: linear-gradient(90deg, #BF9A33, #D4AF37); border-radius: 4px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; top: 0; left: 0;"></div>
                                </div>
                                <span id="scoreEstrutura" style="font-size: 0.85rem; color: #BF9A33; font-weight: 600; width: 35px; text-align: right;">--</span>
                            </div>
                            
                            <!-- Conte√∫do -->
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 0.85rem; font-weight: 500; color: #1a1a1a; width: 90px;">Conte√∫do</span>
                                <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; position: relative;">
                                    <div id="barConteudo" style="height: 100%; background: linear-gradient(90deg, #BF9A33, #D4AF37); border-radius: 4px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; top: 0; left: 0;"></div>
                                </div>
                                <span id="scoreConteudo" style="font-size: 0.85rem; color: #BF9A33; font-weight: 600; width: 35px; text-align: right;">--</span>
                            </div>
                            
                            <!-- Forma√ß√£o -->
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 0.85rem; font-weight: 500; color: #1a1a1a; width: 90px;">Forma√ß√£o</span>
                                <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; position: relative;">
                                    <div id="barFormacao" style="height: 100%; background: linear-gradient(90deg, #BF9A33, #D4AF37); border-radius: 4px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; top: 0; left: 0;"></div>
                                </div>
                                <span id="scoreFormacao" style="font-size: 0.85rem; color: #BF9A33; font-weight: 600; width: 35px; text-align: right;">--</span>
                            </div>
                            
                            <!-- Experi√™ncia -->
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 0.85rem; font-weight: 500; color: #1a1a1a; width: 90px;">Experi√™ncia</span>
                                <div style="flex: 1; height: 8px; background: #e8e8e8; border-radius: 4px; position: relative;">
                                    <div id="barExperiencia" style="height: 100%; background: linear-gradient(90deg, #BF9A33, #D4AF37); border-radius: 4px; width: 0%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); position: absolute; top: 0; left: 0;"></div>
                                </div>
                                <span id="scoreExperiencia" style="font-size: 0.85rem; color: #BF9A33; font-weight: 600; width: 35px; text-align: right;">--</span>
                            </div>
                        </div>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- COMPATIBILIDADE ATS - Dashboard Style -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1.5rem; text-align: center;">Compatibilidade ATS</h6>
                        
                        <!-- C√≠rculo de Progresso Centrado -->
                        <div style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;">
                            <div style="position: relative; width: 140px; height: 140px;">
                                <!-- SVG C√≠rculo de Progresso -->
                                <svg width="140" height="140" style="transform: rotate(-90deg);">
                                    <!-- C√≠rculo de fundo -->
                                    <circle cx="70" cy="70" r="60" fill="none" stroke="#f0f0f0" stroke-width="10"/>
                                    <!-- C√≠rculo de progresso -->
                                    <circle id="atsProgressCircle" cx="70" cy="70" r="60" fill="none" stroke="#BF9A33" stroke-width="10" 
                                        stroke-dasharray="377" stroke-dashoffset="377" 
                                        stroke-linecap="round"
                                        style="transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);"/>
                                </svg>
                                <!-- Score no centro -->
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                    <div id="atsScoreDisplay" style="font-size: 2.5rem; font-weight: 700; color: #1a1a1a; line-height: 1;">--</div>
                                    <div style="font-size: 0.65rem; color: #999; margin-top: 2px;">de 100</div>
                                </div>
                            </div>
                            <!-- Label de n√≠vel -->
                            <div id="atsLevelBadge" style="font-size: 0.9rem; font-weight: 500; color: #BF9A33; margin-top: 1rem;">A calcular...</div>
                        </div>
                        
                        <!-- Diagn√≥stico -->
                        <div id="atsDiagnosticBox" style="margin-bottom: 1.25rem;">
                            <div style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.75rem;">Diagn√≥stico</div>
                            <ul id="atsLevelBullets" style="list-style: none; padding: 0; margin: 0; display: grid; gap: 0.5rem;">
                                <li style="font-size: 0.85rem; color: #555; padding-left: 1rem; position: relative;"><span style="position: absolute; left: 0; color: #BF9A33;">‚Ä¢</span> A aguardar an√°lise...</li>
                            </ul>
                        </div>
                        
                        <!-- Gatilhos -->
                        <div id="atsTriggersBox">
                            <div style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.75rem;">Palavras-chave</div>
                            <div id="atsTriggersList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <span style="font-size: 0.8rem; color: #666;">A identificar...</span>
                            </div>
                        </div>
                        
                        <!-- Barra de progresso escondida para compatibilidade -->
                        <div id="atsProgressBar" style="display: none;"></div>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- FORMA√á√ÉO -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Forma√ß√£o</h6>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">√öltima forma√ß√£o</div>
                                <div id="lastEducation" style="font-size: 0.9rem; color: #1a1a1a;">A verificar...</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Ritmo de atualiza√ß√£o</div>
                                <div id="updateRhythm" style="font-size: 0.9rem; color: #1a1a1a;">A avaliar...</div>
                            </div>
                        </div>
                        
                        <!-- Training Relevance Section (hidden by default) -->
                        <div id="trainingRelevanceSection" style="display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #f0f0f0;">
                            <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.5rem;">Score de Alinhamento: <span id="trainingScore" style="color: #1a1a1a; font-weight: 600;">--/100</span></div>
                            <div id="trainingAssessment" style="font-size: 0.85rem; color: #666;">A analisar...</div>
                            <div id="alignedCoursesDiv" style="display: none; margin-top: 0.75rem;">
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Forma√ß√µes Relevantes</div>
                                <ul id="alignedCoursesList" style="font-size: 0.85rem; margin: 0; padding-left: 1rem; color: #444;"></ul>
                            </div>
                            <div id="recommendedCoursesDiv" style="display: none; margin-top: 0.75rem;">
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Recomenda√ß√µes</div>
                                <ul id="recommendedCoursesList" style="font-size: 0.85rem; margin: 0; padding-left: 1rem; color: #666;"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- ESTRUTURA DO DOCUMENTO -->
                    <div style="margin-bottom: 2rem;">
                        <h6 style="font-size: 0.7rem; font-weight: 600; color: #999; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 1rem;">Estrutura do Documento</h6>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Organiza√ß√£o</div>
                                <div id="cvStructure" style="font-size: 0.9rem; color: #1a1a1a;">A verificar...</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #999; margin-bottom: 0.25rem;">Legibilidade</div>
                                <div id="readability" style="font-size: 0.9rem; color: #1a1a1a;">A analisar...</div>
                            </div>
                        </div>
                    </div>

                    <hr style="border: none; border-top: 1px solid #f0f0f0; margin: 1.5rem 0;">

                    <!-- CTA RELAT√ìRIO COMPLETO -->
                    <div style="text-align: center; padding: 1.5rem; background: #fafafa; border-radius: 12px;">
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">Relat√≥rio Completo</div>
                        <div style="font-size: 2rem; font-weight: 700; color: #1a1a1a; margin-bottom: 0.25rem;">2,99 ‚Ç¨</div>
                        <div style="font-size: 0.8rem; color: #999; margin-bottom: 1rem;">PDF enviado por email</div>
                        <ul style="list-style: none; padding: 0; margin: 0 0 1rem 0; font-size: 0.8rem; color: #666; text-align: left; max-width: 250px; margin-left: auto; margin-right: auto;">
                            <li style="padding: 0.25rem 0;">‚Üí Diagn√≥stico detalhado</li>
                            <li style="padding: 0.25rem 0;">‚Üí Pontos fortes e fragilidades</li>
                            <li style="padding: 0.25rem 0;">‚Üí Recomenda√ß√µes acion√°veis</li>
                            <li style="padding: 0.25rem 0;">‚Üí Plano de evolu√ß√£o</li>
                        </ul>
                    </div>

                </div>
                
                <!-- FOOTER MINIMALISTA -->
                <div class="modal-footer" style="background: #fff; border-top: 1px solid #eee; padding: 1rem 2rem; justify-content: space-between;">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background: transparent; border: 1px solid #ddd; color: #666; border-radius: 8px; padding: 0.5rem 1.25rem; font-size: 0.85rem;">Fechar</button>
                    <button type="button" class="btn" onclick="openReportPaymentModal()" style="background: #1a1a1a; border: none; color: #fff; border-radius: 8px; padding: 0.5rem 1.5rem; font-size: 0.85rem; font-weight: 500;">Obter Relat√≥rio Completo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal for 2,99‚Ç¨ PDF Report -->
    <div class="modal fade" id="reportPaymentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 500px;">
            <div class="modal-content" style="border-radius: 16px; border: none;">
                <div class="modal-header border-0">
                    <div style="text-align: center; width: 100%;">
                        <h5 class="modal-title" style="font-size: 1.2rem; font-weight: 500; color: #333;">An√°lise de CV
                            Inteligente</h5>
                        <p class="text-muted mb-0" style="font-size: 0.8rem; font-weight: 400;">Relat√≥rio detalhado
                            enviado por email</p>
                    </div>
                    <button type="button" class="btn-close position-absolute end-0 top-0 m-3"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body px-4 py-3">

                    <!-- Info Note -->
                    <div class="mb-3"
                        style="background: #f8f9fa; border-left: 3px solid #BF9A33; padding: 0.75rem; border-radius: 6px;">
                        <div
                            style="display: flex; gap: 8px; align-items: start; font-size: 0.8rem; font-weight: 400; color: #555;">
                            <span style="color: #BF9A33; flex-shrink: 0;">‚ë†</span>
                            <span>An√°lise instant√¢nea do teu CV (estrutura + conte√∫do)</span>
                        </div>
                        <div
                            style="display: flex; gap: 8px; align-items: start; font-size: 0.8rem; font-weight: 400; color: #555; margin-top: 0.5rem;">
                            <span style="color: #BF9A33; flex-shrink: 0;">‚ë°</span>
                            <span>Relat√≥rio PDF completo enviado para o teu email</span>
                        </div>
                        <small class="d-block mt-2" style="color: #888; font-size: 0.7rem; font-weight: 400;">‚è± Entrega
                            autom√°tica ap√≥s pagamento</small>
                    </div>

                    <!-- PAYMENT FORM -->
                    <form id="reportPaymentForm">
                        <div class="mb-3">
                            <label class="form-label"
                                style="font-weight: 500; font-size: 0.9rem; color: #1A1A1A;">Nome</label>
                            <input type="text" class="form-control" id="paymentName" required
                                style="border: 1px solid #dee2e6; border-radius: 6px; padding: 0.6rem;">
                        </div>
                        <div class="mb-3">
                            <label class="form-label"
                                style="font-weight: 500; font-size: 0.9rem; color: #1A1A1A;">Email</label>
                            <input type="email" class="form-control" id="paymentEmail" required
                                style="border: 1px solid #dee2e6; border-radius: 6px; padding: 0.6rem;">
                        </div>
                        <div class="mb-3">
                            <label class="form-label"
                                style="font-weight: 500; font-size: 0.9rem; color: #1A1A1A;">Telem√≥vel</label>
                            <input type="tel" class="form-control" id="paymentPhone" required placeholder="961925050"
                                pattern="[0-9]{9}"
                                style="border: 1px solid #dee2e6; border-radius: 6px; padding: 0.6rem;">
                            <small class="form-text"
                                style="font-size: 0.7rem; font-weight: 400; color: #888; margin-top: 0.25rem;">
                                üîí Pagamento seguro MB WAY. Recebes notifica√ß√£o no telem√≥vel.
                            </small>
                        </div>

                        <div id="paymentStatusMsg" class="d-none"></div>

                        <button type="submit" class="btn w-100 mt-2 py-2" id="btnPayReport"
                            style="background: #BF9A33; border: none; color: #fff; font-weight: 600; font-size: 0.95rem; border-radius: 6px;">
                            Receber Relat√≥rio (2,99‚Ç¨ via MB WAY)
                        </button>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- PDF.js & Mammoth.js for Real File Reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Footer -->
    <footer id="contactos" style="background-color: #1A1A1A; color: #fff; padding: 40px 0;">
        <div class="container">
            <div class="row g-4">
                <div class="col-lg-4">
                    <img src="../images/logo.png" alt="Share2Inspire" height="40" class="mb-3">
                    <p style="color: #999; font-size: 0.9rem; margin: 0;">Evolu√ß√£o de carreira com clareza, estrat√©gia e
                        narrativa de impacto.</p>
                </div>
                <div class="col-lg-4 text-center">
                    <h5 style="color: #fff; font-size: 0.95rem; font-weight: 600; margin-bottom: 1rem;">Contactos</h5>
                    <p style="color: #BF9A33; font-size: 0.9rem; margin: 0;">
                        <i class="fas fa-envelope me-2"></i>srshare2inspire@gmail.com
                    </p>
                </div>
                <div class="col-lg-4">
                    <h5 style="color: #fff; font-size: 0.95rem; font-weight: 600; margin-bottom: 1rem;">Siga-nos</h5>
                    <ul class="list-unstyled" style="line-height: 1.8; margin: 0;">
                        <li><a href="https://www.instagram.com/share2inspire_/" target="_blank"
                                style="color: #fff; text-decoration: none; font-size: 0.85rem;"
                                onmouseover="this.style.color='#BF9A33'"
                                onmouseout="this.style.color='#fff'">Share2Inspire Instagram</a></li>
                        <li><a href="https://www.linkedin.com/in/samuelrolo/" target="_blank"
                                style="color: #fff; text-decoration: none; font-size: 0.85rem;"
                                onmouseover="this.style.color='#BF9A33'"
                                onmouseout="this.style.color='#fff'">Share2Inspire LinkedIn</a></li>
                        <li><a href="https://www.instagram.com/samuel_rolo/" target="_blank"
                                style="color: #fff; text-decoration: none; font-size: 0.85rem;"
                                onmouseover="this.style.color='#BF9A33'" onmouseout="this.style.color='#fff'">Samuel
                                Instagram</a></li>
                        <li><a href="https://www.instagram.com/borgesfala/" target="_blank"
                                style="color: #fff; text-decoration: none; font-size: 0.85rem;"
                                onmouseover="this.style.color='#BF9A33'" onmouseout="this.style.color='#fff'">Borges
                                Instagram</a></li>
                        <li><a href="https://www.instagram.com/kins_knowledge/" target="_blank"
                                style="color: #fff; text-decoration: none; font-size: 0.85rem;"
                                onmouseover="this.style.color='#BF9A33'" onmouseout="this.style.color='#fff'">KINS
                                Instagram</a></li>
                    </ul>
                </div>
            </div>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 2rem 0 1.5rem;">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    <p style="color: #999; font-size: 0.8rem; margin: 0;">¬© 2025 Share2Inspire. Todos os direitos
                        reservados.</p>
                </div>
                <div class="col-md-6 text-center text-md-end mt-2 mt-md-0">
                    <a href="politica-privacidade.html"
                        style="color: #999; text-decoration: none; font-size: 0.8rem; margin: 0 0.5rem;">Privacidade</a>
                    <a href="politica-cookies.html"
                        style="color: #999; text-decoration: none; font-size: 0.8rem; margin: 0 0.5rem;">Cookies</a>
                    <a href="tratamento-dados.html"
                        style="color: #999; text-decoration: none; font-size: 0.8rem; margin: 0 0.5rem;">Dados</a>
                    <a href="informacao-legal.html"
                        style="color: #999; text-decoration: none; font-size: 0.8rem; margin: 0 0.5rem;">Legal</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <div class="container">
        <div class="row align-items-center mb-4">
            <div class="col-lg-4 mb-3 mb-lg-0">
                <img src="../images/logo.png" alt="Share2Inspire" height="40" class="mb-3">
                <p class="mb-0" style="color: #999; font-size: 0.9rem;">Evolu√ß√£o de carreira com clareza, estrat√©gia
                    e narrativa de impacto.</p>
            </div>
            <div class="col-lg-4 text-center mb-3 mb-lg-0">
                <p class="mb-2" style="font-size: 0.9rem; color: #BF9A33;">
                    <i class="fas fa-envelope me-2"></i>srshare2inspire@gmail.com
                </p>
            </div>
            <div class="col-lg-4 text-center text-lg-end">
                <div class="d-flex justify-content-center justify-content-lg-end gap-4">
                    <div class="text-center">
                        <a href="https://www.linkedin.com/in/samuelrolo/" target="_blank"
                            style="color: #BF9A33; font-size: 1.3rem; display: block; margin-bottom: 4px;"
                            aria-label="LinkedIn">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        <small style="font-size: 0.65rem; color: #999; display: block;">LinkedIn</small>
                    </div>
                    <div class="text-center">
                        <a href="https://www.instagram.com/samuel_rolo/" target="_blank"
                            style="color: #BF9A33; font-size: 1.3rem; display: block; margin-bottom: 4px;"
                            aria-label="Instagram Samuel">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <small style="font-size: 0.65rem; color: #999; display: block;">@samuel_rolo</small>
                    </div>
                    <div class="text-center">
                        <a href="https://www.instagram.com/borgesfala/" target="_blank"
                            style="color: #BF9A33; font-size: 1.3rem; display: block; margin-bottom: 4px;"
                            aria-label="Instagram Borges">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <small style="font-size: 0.65rem; color: #999; display: block;">@borgesfala</small>
                    </div>
                    <div class="text-center">
                        <a href="https://www.instagram.com/kins_knowledge/" target="_blank"
                            style="color: #BF9A33; font-size: 1.3rem; display: block; margin-bottom: 4px;"
                            aria-label="Instagram Kins">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <small style="font-size: 0.65rem; color: #999; display: block;">@kins_knowledge</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-center pt-3"
                    style="border-top: 1px solid rgba(255,255,255,0.1);">
                    <p class="mb-2 mb-md-0" style="font-size: 0.85rem; color: #BF9A33;">
                        ¬© 2025 Share2Inspire. Todos os direitos reservados.
                    </p>
                    <div class="d-flex gap-3 flex-wrap justify-content-center">
                        <a href="politica-privacidade.html"
                            style="color: #BF9A33; font-size: 0.85rem; text-decoration: none;">Pol√≠tica de
                            Privacidade</a>
                        <a href="politica-cookies.html"
                            style="color: #BF9A33; font-size: 0.85rem; text-decoration: none;">Pol√≠tica de
                            Cookies</a>
                        <a href="tratamento-dados.html"
                            style="color: #BF9A33; font-size: 0.85rem; text-decoration: none;">Tratamento de
                            Dados</a>
                        <a href="informacao-legal.html"
                            style="color: #BF9A33; font-size: 0.85rem; text-decoration: none;">Informa√ß√£o Legal</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="../js/ifthenpay-integration.js"></script>
    <script src="../js/cv-engine.js"></script>
    <script src="../js/pdf-generator-modern.js"></script>

    <script>
        const fileInput = document.getElementById('cvFile');
        const fileNameDisplay = document.getElementById('fileName');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const btnSpinner = document.getElementById('btnSpinner');
        const btnText = document.getElementById('btnText');

        // Mostrar nome do ficheiro selecionado
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                fileNameDisplay.textContent = e.target.files[0].name;
                analyzeBtn.disabled = false;
            }
        });

        // Clique no Bot√£o Analisar - REAL FILE PROCESSING
        analyzeBtn.addEventListener('click', async () => {
            // UI Loading
            analyzeBtn.disabled = true;
            btnSpinner.classList.remove('d-none');
            btnText.textContent = 'A LER & ANALISAR...';

            const file = fileInput.files[0];

            if (file) {
                // >>> GUARDAR FICHEIRO GLOBALMENTE PARA USO POSTERIOR <<<
                window.currentCVFile = file;
                console.log('[CV] Ficheiro guardado em window.currentCVFile:', file.name);
                
                try {
                    // Chamar o Motor de An√°lise Real (PDF.js + Mammoth.js + Heuristics)
                    const success = await window.CV_ENGINE.analyzeFile(file);

                    if (success) {
                        // Abrir Modal com Resultados
                        const modal = new bootstrap.Modal(document.getElementById('resultsModal'));
                        modal.show();
                    }
                } catch (error) {
                    // Handle specific validation errors with user-friendly messages
                    if (error.message === 'INVALID_DOCUMENT_TYPE') {
                        alert('‚ö†Ô∏è DOCUMENTO INV√ÅLIDO\n\n' +
                            'Este parece ser um Cart√£o de Cidad√£o ou outro documento oficial, n√£o um CV.\n\n' +
                            'Por favor, carregue um Curriculum Vitae (CV/Resume) profissional.');
                    } else if (error.message === 'MISSING_CV_CONTENT') {
                        const userConfirm = confirm(
                            '‚ö†Ô∏è N√ÉO √â UM CV / INFORMA√á√ÉO INSUFICIENTE\n\n' +
                            'O documento carregado n√£o parece ter a informa√ß√£o necess√°ria para an√°lise.\n\n' +
                            'Um CV deve incluir:\n' +
                            '‚úì Experi√™ncia profissional OU Forma√ß√£o acad√©mica\n' +
                            '‚úì Compet√™ncias/Skills\n\n' +
                            'Garante que est√°s a carregar o teu CV e/ou atualiza-o com a informa√ß√£o m√≠nima.\n\n' +
                            'üí¨ Precisas de ajuda? Clica OK para ir aos contactos.'
                        );
                        if (userConfirm) {
                            // Scroll to footer contacts section
                            document.getElementById('contactos')?.scrollIntoView({ behavior: 'smooth' });
                        }
                    } else if (error.message === 'DOCUMENT_TOO_SHORT') {
                        alert('‚ö†Ô∏è DOCUMENTO MUITO CURTO\n\n' +
                            'O documento n√£o parece ser um CV completo.\n\n' +
                            'Por favor, carregue um CV mais detalhado com experi√™ncia, forma√ß√£o e compet√™ncias.');
                    } else if (error.message === 'SUSPICIOUS_DOCUMENT') {
                        alert('‚ö†Ô∏è DOCUMENTO SUSPEITO\n\n' +
                            'O documento cont√©m caracter√≠sticas at√≠picas de um CV.\n\n' +
                            'Certifica-te de que est√°s a carregar um Curriculum Vitae (CV/Resume).');
                    } else {
                        alert('Erro ao processar ficheiro: ' + error.message);
                    }
                    console.error('[CV ANALYSIS] Error:', error);
                }
            }

            // Reset UI
            analyzeBtn.disabled = false;
            btnSpinner.classList.add('d-none');
            btnText.textContent = 'INICIAR AN√ÅLISE IA';
        });

        // Nota: A fun√ß√£o renderRadarChart est√° agora definida no cv-engine.js
        // com os 6 novos fatores: Estrutura, Conte√∫do, Impacto, Forma√ß√£o, Experi√™ncia, Compet√™ncias

        // Open Payment Modal Function
        function openReportPaymentModal() {
            // Close results modal
            const resultsModalEl = document.getElementById('resultsModal');
            if (resultsModalEl) {
                const resultsModal = bootstrap.Modal.getInstance(resultsModalEl);
                if (resultsModal) resultsModal.hide();
            }

            // Open payment modal
            const paymentModal = new bootstrap.Modal(document.getElementById('reportPaymentModal'));
            paymentModal.show();
        }

        // Handle Payment Form Submission - USING IFTHENPAY INTEGRATION
        document.getElementById('reportPaymentForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('paymentName').value.trim();
            const email = document.getElementById('paymentEmail').value.trim();
            const phone = document.getElementById('paymentPhone').value.replace(/\D/g, ''); // Remove non-digits

            if (!name || !email || !phone) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            if (phone.length !== 9) {
                alert('O n√∫mero de telem√≥vel deve ter 9 d√≠gitos.');
                return;
            }

            const btnPayReport = document.getElementById('btnPayReport');
            const statusMsg = document.getElementById('paymentStatusMsg');
            const originalBtnText = btnPayReport.innerHTML;

            // Set loading state
            btnPayReport.disabled = true;
            btnPayReport.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> A processar...';
            statusMsg.classList.remove('d-none');
            statusMsg.innerHTML = '<div class="alert alert-info"><i class="fas fa-info-circle me-2"></i> A iniciar pagamento MB WAY...</div>';

            try {
                // CRITICAL FIX: Call backend endpoint that SAVES analysis data before payment
                // This is necessary so the webhook can deliver the report after payment confirmation
                const BACKEND_URL = 'https://share2inspire-beckend.lm.r.appspot.com';
                const orderId = `CVA-${Date.now()}`;


                // Transform CV_ENGINE data to backend expected format
                const transformedData = window.CV_ENGINE?.data ? {
                    candidate_profile: {
                        detected_name: window.CV_ENGINE.data.extractedData?.name || 'Candidato',
                        detected_role: window.CV_ENGINE.data.extractedData?.currentRole || window.CV_ENGINE.data.extractedData?.mainArea || 'Profissional',
                        total_years_exp: `Anos de experi√™ncia acumulada: ${window.CV_ENGINE.data.extractedData?.yearsExperience || 0}`,
                        seniority: window.CV_ENGINE.data.extractedData?.seniorityLevel || 'A definir'
                    },
                    maturity_and_skills: window.CV_ENGINE.data.extractedData?.hardSkills?.slice(0, 3).map(skill => ({
                        title: skill,
                        metric: 'Identificado',
                        detail: 'Compet√™ncia t√©cnica presente no CV'
                    })) || [],
                    key_strengths: window.CV_ENGINE.data.extractedData?.softSkills?.slice(0, 3).map(skill => ({
                        title: skill,
                        metric: 'Forte',
                        detail: 'Soft skill evidenciada'
                    })) || [],
                    evolution_roadmap: {
                        pdf_details: [{
                            title: 'Pr√≥ximos Passos',
                            context: '√Åreas de desenvolvimento identificadas',
                            actions: ['Continuar a desenvolver compet√™ncias t√©cnicas', 'Refor√ßar experi√™ncia na √°rea']
                        }]
                    },
                    strategic_feedback: {
                        pdf_details: {
                            market_read: 'CV analisado com sucesso',
                            what_to_reinforce: window.CV_ENGINE.data.extractedData?.hardSkills?.slice(0, 2).join(', ') || 'Compet√™ncias identificadas',
                            what_to_adjust: 'Continuar a desenvolver perfil profissional'
                        }
                    },
                    radar_data: {
                        ats: window.CV_ENGINE.data.atsAnalysis?.score || 70,
                        impact: window.CV_ENGINE.data.spiderFactors?.impacto || 65,
                        structure: window.CV_ENGINE.data.spiderFactors?.estrutura || 70,
                        market_fit: 60,
                        readiness: 65
                    },
                    final_verdict: {
                        score: window.CV_ENGINE.data.maturity?.score || 70
                    }
                } : {};

                const requestData = {
                    name: name,
                    email: email,
                    phone: phone,
                    analysis_data: transformedData  // ‚úÖ Send transformed data with candidate_profile
                };

                console.log('üí≥ Sending payment request with analysis data to backend...');

                const response = await fetch(`${BACKEND_URL}/api/services/request-report-payment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || 'Erro ao processar pagamento');
                }

                console.log('‚úÖ Payment initiated, analysis data saved:', result);

                // >>> WHITELIST CHECK: Bypass de pagamento <<<
                if (result.skipPayment || result.whitelist) {
                    console.log('[WHITELIST] Email na whitelist - enviando relat√≥rio diretamente');
                    console.log('[WHITELIST] currentCVFile:', window.currentCVFile);
                    console.log('[WHITELIST] currentReportData:', window.currentReportData);
                    console.log('[WHITELIST] transformedData:', transformedData);
                    
                    // Verificar se temos o ficheiro CV
                    if (!window.currentCVFile) {
                        console.error('[WHITELIST] ERRO: CV file n√£o encontrado!');
                        statusMsg.innerHTML = `
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <strong>Erro:</strong> Ficheiro CV n√£o encontrado. Por favor, fa√ßa upload novamente.
                            </div>
                        `;
                        btnPayReport.disabled = false;
                        btnPayReport.innerHTML = originalBtnText;
                        return;
                    }
                    
                    statusMsg.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-star me-2"></i>
                            <strong>Email VIP detetado!</strong><br>
                            <small>A gerar e enviar relat√≥rio...</small>
                        </div>
                    `;
                    
                    // Enviar relat√≥rio diretamente
                    try {
                        const deliverFormData = new FormData();
                        deliverFormData.append('name', name);
                        deliverFormData.append('email', email);
                        deliverFormData.append('cv_file', window.currentCVFile);
                        
                        // Usar dados da an√°lise dispon√≠veis
                        const reportData = window.currentReportData || transformedData || {};
                        console.log('[WHITELIST] Report data a enviar:', reportData);
                        deliverFormData.append('report', JSON.stringify(reportData));
                        
                        const deliverResponse = await fetch(`${BACKEND_URL}/api/services/deliver-report`, {
                            method: 'POST',
                            body: deliverFormData
                        });
                        
                        const deliverResult = await deliverResponse.json();
                        
                        if (deliverResult.success) {
                            statusMsg.innerHTML = `
                                <div class="alert alert-success">
                                    <i class="fas fa-envelope-open-text me-2"></i>
                                    <strong>Relat√≥rio enviado!</strong><br>
                                    <small>Verifique o seu email: <strong>${email}</strong></small>
                                </div>
                            `;
                        } else {
                            throw new Error(deliverResult.error || 'Erro ao enviar relat√≥rio');
                        }
                    } catch (deliverError) {
                        console.error('Delivery error:', deliverError);
                        statusMsg.innerHTML = `
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <small>Relat√≥rio ser√° enviado em breve para ${email}</small>
                            </div>
                        `;
                    }
                    
                    // Reset button
                    setTimeout(() => {
                        btnPayReport.disabled = false;
                        btnPayReport.innerHTML = originalBtnText;
                    }, 3000);
                    
                    return; // Sair - n√£o fazer polling
                }

                // üîÑ START POLLING: Check payment status and trigger delivery
                const startPolling = (orderId) => {
                    let attempts = 0;
                    const maxAttempts = 30; // 5 minutes (10s intervals)

                    console.log(`üîÑ Starting polling for order: ${orderId}`);

                    const pollInterval = setInterval(async () => {
                        attempts++;
                        console.log(`üîÑ Poll attempt ${attempts}/${maxAttempts} for ${orderId}`);

                        try {
                            // Check payment status
                            const statusResponse = await fetch(`${BACKEND_URL}/api/payment/status/${orderId}`);
                            const statusData = await statusResponse.json();

                            if (statusData.success && statusData.record) {
                                const record = statusData.record;

                                // If paid and not yet delivered, trigger delivery
                                if (record.paid && !record.delivered) {
                                    console.log('‚úÖ Payment confirmed! Triggering delivery...');
                                    clearInterval(pollInterval);

                                    // Trigger manual delivery
                                    const deliveryResponse = await fetch(`${BACKEND_URL}/api/services/trigger-delivery/${orderId}`, {
                                        method: 'POST'
                                    });
                                    const deliveryData = await deliveryResponse.json();

                                    if (deliveryData.success) {
                                        console.log('üìß Report delivered successfully!');
                                        statusMsg.innerHTML = `
                                            <div class="alert alert-success">
                                                <strong>‚úÖ Pagamento confirmado!</strong><br>
                                                O relat√≥rio foi enviado para <strong>${email}</strong>
                                            </div>
                                        `;
                                    }
                                }

                                // If already delivered, stop polling
                                if (record.delivered) {
                                    console.log('üìß Report already delivered');
                                    clearInterval(pollInterval);
                                }
                            }

                            // Stop after max attempts
                            if (attempts >= maxAttempts) {
                                console.log('‚è± Polling timeout reached');
                                clearInterval(pollInterval);
                            }

                        } catch (error) {
                            console.warn(`Poll error:`, error);
                        }
                    }, 10000); // Poll every 10 seconds
                };

                // Start polling with the order ID
                startPolling(result.requestId);

                // Payment initiated successfully
                statusMsg.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fas fa-mobile-alt me-2"></i>
                        <strong>Pedido MB WAY enviado!</strong><br>
                        <small>Por favor, confirme na sua aplica√ß√£o MB WAY. O relat√≥rio ser√° enviado ap√≥s confirma√ß√£o do pagamento.</small>
                    </div>
                `;

                // Show instructions
                setTimeout(() => {
                    statusMsg.innerHTML += `
                        <div class="alert alert-info mt-2">
                            <i class="fas fa-info-circle me-2"></i>
                            <small><strong>Pr√≥ximos passos:</strong><br>
                            1. Confirme o pagamento de 2,99‚Ç¨ na sua app MB WAY<br>
                            2. O relat√≥rio ser√° enviado automaticamente para <strong>${email}</strong> ap√≥s confirma√ß√£o</small>
                        </div>
                    `;
                }, 2000);

                // Reset button after delay
                setTimeout(() => {
                    btnPayReport.disabled = false;
                    btnPayReport.innerHTML = originalBtnText;
                }, 5000);

            } catch (error) {
                console.error('Payment Error:', error);
                statusMsg.innerHTML = `<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i> ${error.message}</div>`;
                btnPayReport.disabled = false;
                btnPayReport.innerHTML = originalBtnText;
            }
        });

        /* REMOVED: Polling functions - Backend handles this via Ifthenpay callbacks
        // Poll Payment Status
        async function pollPaymentStatus(orderId, name, email, backendUrl) {
            const statusMsg = document.getElementById('paymentStatusMsg');
            let pollCount = 0;
            const maxPolls = 60; // 3 minutes (3s * 60)

            const checkStatus = async () => {
                try {
                    const response = await fetch(`${backendUrl}/api/payment/status/${orderId}`);
                    const data = await response.json();

                    if (data.success && data.paid) {
                        // Payment confirmed!
                        statusMsg.innerHTML = `
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle me-2"></i>
                                <strong>Pagamento confirmado!</strong><br>
                                <small>A gerar e enviar relat√≥rio PDF para ${email}...</small>
                            </div>
                        `;

                        // Trigger report delivery
                        await deliverPDFReport(name, email, backendUrl);

                        // Final success message
                        statusMsg.innerHTML = `
                            <div class="alert alert-success">
                                <i class="fas fa-envelope-open-text me-2"></i>
                                <strong>Relat√≥rio enviado com sucesso!</strong><br>
                                <small>Verifique o seu email ${email}</small>
                            </div>
                        `;

                        setTimeout(() => {
                            bootstrap.Modal.getInstance(document.getElementById('reportPaymentModal')).hide();
                        }, 4000);

                        return; // Stop polling
                    }

                    // Continue polling
                    pollCount++;
                    if (pollCount < maxPolls) {
                        setTimeout(checkStatus, 3000); // Check every 3 seconds
                    } else {
                        // Timeout
                        statusMsg.innerHTML += '<div class="alert alert-warning small mt-2">Tempo de espera excedido. Se confirmou o pagamento, receber√° o relat√≥rio por email em breve.</div>';
                    }

                } catch (error) {
                    console.error('Polling error:', error);
                }
            };

            // Start polling after 2 seconds
            setTimeout(checkStatus, 2000);
        }

        // Deliver PDF Report
        async function deliverPDFReport(name, email, backendUrl) {
            const reportData = window.CV_ENGINE?.data || {};

            await fetch(`${backendUrl}/api/services/deliver-cv-report`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    name: name,
                    email: email,
                    report: reportData
                })
            });
        }
        */
    </script>
</body>

</html>